var websocketMonitor=function(){"use strict";var _e=Object.defineProperty;var Te=(L,C,P)=>C in L?_e(L,C,{enumerable:!0,configurable:!0,writable:!0,value:P}):L[C]=P;var N=(L,C,P)=>Te(L,typeof C!="symbol"?C+"":C,P);var ne,ae;function L(a){return a}function C(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var P={exports:{}},ie=P.exports,X;function oe(){return X||(X=1,function(a,e){(function(t,r){r(a)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:ie,function(t){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)t.exports=globalThis.browser;else{const r="The message port closed before a response was received.",w=c=>{const x={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(x).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class v extends WeakMap{constructor(g,u=void 0){super(u),this.createItem=g}get(g){return this.has(g)||this.set(g,this.createItem(g)),super.get(g)}}const M=l=>l&&typeof l=="object"&&typeof l.then=="function",I=(l,g)=>(...u)=>{c.runtime.lastError?l.reject(new Error(c.runtime.lastError.message)):g.singleCallbackArg||u.length<=1&&g.singleCallbackArg!==!1?l.resolve(u[0]):l.resolve(u)},p=l=>l==1?"argument":"arguments",T=(l,g)=>function(A,...f){if(f.length<g.minArgs)throw new Error(`Expected at least ${g.minArgs} ${p(g.minArgs)} for ${l}(), got ${f.length}`);if(f.length>g.maxArgs)throw new Error(`Expected at most ${g.maxArgs} ${p(g.maxArgs)} for ${l}(), got ${f.length}`);return new Promise((E,k)=>{if(g.fallbackToNoCallback)try{A[l](...f,I({resolve:E,reject:k},g))}catch(h){console.warn(`${l} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,h),A[l](...f),g.fallbackToNoCallback=!1,g.noCallback=!0,E()}else g.noCallback?(A[l](...f),E()):A[l](...f,I({resolve:E,reject:k},g))})},q=(l,g,u)=>new Proxy(g,{apply(A,f,E){return u.call(f,l,...E)}});let F=Function.call.bind(Object.prototype.hasOwnProperty);const O=(l,g={},u={})=>{let A=Object.create(null),f={has(k,h){return h in l||h in A},get(k,h,S){if(h in A)return A[h];if(!(h in l))return;let y=l[h];if(typeof y=="function")if(typeof g[h]=="function")y=q(l,l[h],g[h]);else if(F(u,h)){let $=T(h,u[h]);y=q(l,l[h],$)}else y=y.bind(l);else if(typeof y=="object"&&y!==null&&(F(g,h)||F(u,h)))y=O(y,g[h],u[h]);else if(F(u,"*"))y=O(y,g[h],u["*"]);else return Object.defineProperty(A,h,{configurable:!0,enumerable:!0,get(){return l[h]},set($){l[h]=$}}),y;return A[h]=y,y},set(k,h,S,y){return h in A?A[h]=S:l[h]=S,!0},defineProperty(k,h,S){return Reflect.defineProperty(A,h,S)},deleteProperty(k,h){return Reflect.deleteProperty(A,h)}},E=Object.create(l);return new Proxy(E,f)},i=l=>({addListener(g,u,...A){g.addListener(l.get(u),...A)},hasListener(g,u){return g.hasListener(l.get(u))},removeListener(g,u){g.removeListener(l.get(u))}}),n=new v(l=>typeof l!="function"?l:function(u){const A=O(u,{},{getContent:{minArgs:0,maxArgs:0}});l(A)}),s=new v(l=>typeof l!="function"?l:function(u,A,f){let E=!1,k,h=new Promise(V=>{k=function(_){E=!0,V(_)}}),S;try{S=l(u,A,k)}catch(V){S=Promise.reject(V)}const y=S!==!0&&M(S);if(S!==!0&&!y&&!E)return!1;const $=V=>{V.then(_=>{f(_)},_=>{let Q;_&&(_ instanceof Error||typeof _.message=="string")?Q=_.message:Q="An unexpected error occurred",f({__mozWebExtensionPolyfillReject__:!0,message:Q})}).catch(_=>{console.error("Failed to send onMessage rejected reply",_)})};return $(y?S:h),!0}),o=({reject:l,resolve:g},u)=>{c.runtime.lastError?c.runtime.lastError.message===r?g():l(new Error(c.runtime.lastError.message)):u&&u.__mozWebExtensionPolyfillReject__?l(new Error(u.message)):g(u)},m=(l,g,u,...A)=>{if(A.length<g.minArgs)throw new Error(`Expected at least ${g.minArgs} ${p(g.minArgs)} for ${l}(), got ${A.length}`);if(A.length>g.maxArgs)throw new Error(`Expected at most ${g.maxArgs} ${p(g.maxArgs)} for ${l}(), got ${A.length}`);return new Promise((f,E)=>{const k=o.bind(null,{resolve:f,reject:E});A.push(k),u.sendMessage(...A)})},d={devtools:{network:{onRequestFinished:i(n)}},runtime:{onMessage:i(s),onMessageExternal:i(s),sendMessage:m.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:m.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},b={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return x.privacy={network:{"*":b},services:{"*":b},websites:{"*":b}},O(c,d,x)};t.exports=w(chrome)}})}(P)),P.exports}var le=oe();const j=C(le);async function ce(a,e){const t=j.runtime.getURL(a),r=document.createElement("script");j.runtime.getManifest().manifest_version===2?r.innerHTML=await fetch(t).then(w=>w.text()):r.src=t,(document.head??document.documentElement).append(r)}var ee=Object.prototype.hasOwnProperty;function Y(a,e){var t,r;if(a===e)return!0;if(a&&e&&(t=a.constructor)===e.constructor){if(t===Date)return a.getTime()===e.getTime();if(t===RegExp)return a.toString()===e.toString();if(t===Array){if((r=a.length)===e.length)for(;r--&&Y(a[r],e[r]););return r===-1}if(!t||typeof a=="object"){r=0;for(t in a)if(ee.call(a,t)&&++r&&!ee.call(e,t)||!(t in e)||!Y(a[t],e[t]))return!1;return Object.keys(e).length===r}}return a!==a&&e!==e}const ge=new Error("request for lock canceled");var me=function(a,e,t,r){function w(c){return c instanceof t?c:new t(function(x){x(c)})}return new(t||(t=Promise))(function(c,x){function v(p){try{I(r.next(p))}catch(T){x(T)}}function M(p){try{I(r.throw(p))}catch(T){x(T)}}function I(p){p.done?c(p.value):w(p.value).then(v,M)}I((r=r.apply(a,e||[])).next())})};class ue{constructor(e,t=ge){this._value=e,this._cancelError=t,this._queue=[],this._weightedWaiters=[]}acquire(e=1,t=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((r,w)=>{const c={resolve:r,reject:w,weight:e,priority:t},x=te(this._queue,v=>t<=v.priority);x===-1&&e<=this._value?this._dispatchItem(c):this._queue.splice(x+1,0,c)})}runExclusive(e){return me(this,arguments,void 0,function*(t,r=1,w=0){const[c,x]=yield this.acquire(r,w);try{return yield t(c)}finally{x()}})}waitForUnlock(e=1,t=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return this._couldLockImmediately(e,t)?Promise.resolve():new Promise(r=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),de(this._weightedWaiters[e-1],{resolve:r,priority:t})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatchQueue()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatchQueue()}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(e){const t=this._value;this._value-=e.weight,e.resolve([t,this._newReleaser(e.weight)])}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let e=this._value;e>0;e--){const t=this._weightedWaiters[e-1];t&&(t.forEach(r=>r.resolve()),this._weightedWaiters[e-1]=[])}else{const e=this._queue[0].priority;for(let t=this._value;t>0;t--){const r=this._weightedWaiters[t-1];if(!r)continue;const w=r.findIndex(c=>c.priority<=e);(w===-1?r:r.splice(0,w)).forEach(c=>c.resolve())}}}_couldLockImmediately(e,t){return(this._queue.length===0||this._queue[0].priority<t)&&e<=this._value}}function de(a,e){const t=te(a,r=>e.priority<=r.priority);a.splice(t+1,0,e)}function te(a,e){for(let t=a.length-1;t>=0;t--)if(e(a[t]))return t;return-1}var Ae=function(a,e,t,r){function w(c){return c instanceof t?c:new t(function(x){x(c)})}return new(t||(t=Promise))(function(c,x){function v(p){try{I(r.next(p))}catch(T){x(T)}}function M(p){try{I(r.throw(p))}catch(T){x(T)}}function I(p){p.done?c(p.value):w(p.value).then(v,M)}I((r=r.apply(a,e||[])).next())})};class he{constructor(e){this._semaphore=new ue(1,e)}acquire(){return Ae(this,arguments,void 0,function*(e=0){const[,t]=yield this._semaphore.acquire(1,e);return t})}runExclusive(e,t=0){return this._semaphore.runExclusive(()=>e(),1,t)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(e=0){return this._semaphore.waitForUnlock(1,e)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}const D=((ae=(ne=globalThis.browser)==null?void 0:ne.runtime)==null?void 0:ae.id)==null?globalThis.chrome:globalThis.browser,K=fe();function fe(){const a={local:W("local"),session:W("session"),sync:W("sync"),managed:W("managed")},e=i=>{const n=a[i];if(n==null){const s=Object.keys(a).join(", ");throw Error(`Invalid area "${i}". Options: ${s}`)}return n},t=i=>{const n=i.indexOf(":"),s=i.substring(0,n),o=i.substring(n+1);if(o==null)throw Error(`Storage key should be in the form of "area:key", but received "${i}"`);return{driverArea:s,driverKey:o,driver:e(s)}},r=i=>i+"$",w=(i,n)=>{const s={...i};return Object.entries(n).forEach(([o,m])=>{m==null?delete s[o]:s[o]=m}),s},c=(i,n)=>i??n??null,x=i=>typeof i=="object"&&!Array.isArray(i)?i:{},v=async(i,n,s)=>{const o=await i.getItem(n);return c(o,(s==null?void 0:s.fallback)??(s==null?void 0:s.defaultValue))},M=async(i,n)=>{const s=r(n),o=await i.getItem(s);return x(o)},I=async(i,n,s)=>{await i.setItem(n,s??null)},p=async(i,n,s)=>{const o=r(n),m=x(await i.getItem(o));await i.setItem(o,w(m,s))},T=async(i,n,s)=>{if(await i.removeItem(n),s!=null&&s.removeMeta){const o=r(n);await i.removeItem(o)}},q=async(i,n,s)=>{const o=r(n);if(s==null)await i.removeItem(o);else{const m=x(await i.getItem(o));[s].flat().forEach(d=>delete m[d]),await i.setItem(o,m)}},F=(i,n,s)=>i.watch(n,s);return{getItem:async(i,n)=>{const{driver:s,driverKey:o}=t(i);return await v(s,o,n)},getItems:async i=>{const n=new Map,s=new Map,o=[];i.forEach(d=>{let b,l;typeof d=="string"?b=d:"getValue"in d?(b=d.key,l={fallback:d.fallback}):(b=d.key,l=d.options),o.push(b);const{driverArea:g,driverKey:u}=t(b),A=n.get(g)??[];n.set(g,A.concat(u)),s.set(b,l)});const m=new Map;return await Promise.all(Array.from(n.entries()).map(async([d,b])=>{(await a[d].getItems(b)).forEach(g=>{const u=`${d}:${g.key}`,A=s.get(u),f=c(g.value,(A==null?void 0:A.fallback)??(A==null?void 0:A.defaultValue));m.set(u,f)})})),o.map(d=>({key:d,value:m.get(d)}))},getMeta:async i=>{const{driver:n,driverKey:s}=t(i);return await M(n,s)},getMetas:async i=>{const n=i.map(m=>{const d=typeof m=="string"?m:m.key,{driverArea:b,driverKey:l}=t(d);return{key:d,driverArea:b,driverKey:l,driverMetaKey:r(l)}}),s=n.reduce((m,d)=>{var b;return m[b=d.driverArea]??(m[b]=[]),m[d.driverArea].push(d),m},{}),o={};return await Promise.all(Object.entries(s).map(async([m,d])=>{const b=await D.storage[m].get(d.map(l=>l.driverMetaKey));d.forEach(l=>{o[l.key]=b[l.driverMetaKey]??{}})})),n.map(m=>({key:m.key,meta:o[m.key]}))},setItem:async(i,n)=>{const{driver:s,driverKey:o}=t(i);await I(s,o,n)},setItems:async i=>{const n={};i.forEach(s=>{const{driverArea:o,driverKey:m}=t("key"in s?s.key:s.item.key);n[o]??(n[o]=[]),n[o].push({key:m,value:s.value})}),await Promise.all(Object.entries(n).map(async([s,o])=>{await e(s).setItems(o)}))},setMeta:async(i,n)=>{const{driver:s,driverKey:o}=t(i);await p(s,o,n)},setMetas:async i=>{const n={};i.forEach(s=>{const{driverArea:o,driverKey:m}=t("key"in s?s.key:s.item.key);n[o]??(n[o]=[]),n[o].push({key:m,properties:s.meta})}),await Promise.all(Object.entries(n).map(async([s,o])=>{const m=e(s),d=o.map(({key:u})=>r(u));console.log(s,d);const b=await m.getItems(d),l=Object.fromEntries(b.map(({key:u,value:A})=>[u,x(A)])),g=o.map(({key:u,properties:A})=>{const f=r(u);return{key:f,value:w(l[f]??{},A)}});await m.setItems(g)}))},removeItem:async(i,n)=>{const{driver:s,driverKey:o}=t(i);await T(s,o,n)},removeItems:async i=>{const n={};i.forEach(s=>{let o,m;typeof s=="string"?o=s:"getValue"in s?o=s.key:"item"in s?(o=s.item.key,m=s.options):(o=s.key,m=s.options);const{driverArea:d,driverKey:b}=t(o);n[d]??(n[d]=[]),n[d].push(b),m!=null&&m.removeMeta&&n[d].push(r(b))}),await Promise.all(Object.entries(n).map(async([s,o])=>{await e(s).removeItems(o)}))},clear:async i=>{await e(i).clear()},removeMeta:async(i,n)=>{const{driver:s,driverKey:o}=t(i);await q(s,o,n)},snapshot:async(i,n)=>{var m;const o=await e(i).snapshot();return(m=n==null?void 0:n.excludeKeys)==null||m.forEach(d=>{delete o[d],delete o[r(d)]}),o},restoreSnapshot:async(i,n)=>{await e(i).restoreSnapshot(n)},watch:(i,n)=>{const{driver:s,driverKey:o}=t(i);return F(s,o,n)},unwatch(){Object.values(a).forEach(i=>{i.unwatch()})},defineItem:(i,n)=>{const{driver:s,driverKey:o}=t(i),{version:m=1,migrations:d={}}=n??{};if(m<1)throw Error("Storage item version cannot be less than 1. Initial versions should be set to 1, not 0.");const b=async()=>{var $;const f=r(o),[{value:E},{value:k}]=await s.getItems([o,f]);if(E==null)return;const h=(k==null?void 0:k.v)??1;if(h>m)throw Error(`Version downgrade detected (v${h} -> v${m}) for "${i}"`);if(h===m)return;console.debug(`[@wxt-dev/storage] Running storage migration for ${i}: v${h} -> v${m}`);const S=Array.from({length:m-h},(V,_)=>h+_+1);let y=E;for(const V of S)try{y=await(($=d==null?void 0:d[V])==null?void 0:$.call(d,y))??y}catch(_){throw new we(i,V,{cause:_})}await s.setItems([{key:o,value:y},{key:f,value:{...k,v:m}}]),console.debug(`[@wxt-dev/storage] Storage migration completed for ${i} v${m}`,{migratedValue:y})},l=(n==null?void 0:n.migrations)==null?Promise.resolve():b().catch(f=>{console.error(`[@wxt-dev/storage] Migration failed for ${i}`,f)}),g=new he,u=()=>(n==null?void 0:n.fallback)??(n==null?void 0:n.defaultValue)??null,A=()=>g.runExclusive(async()=>{const f=await s.getItem(o);if(f!=null||(n==null?void 0:n.init)==null)return f;const E=await n.init();return await s.setItem(o,E),E});return l.then(A),{key:i,get defaultValue(){return u()},get fallback(){return u()},getValue:async()=>(await l,n!=null&&n.init?await A():await v(s,o,n)),getMeta:async()=>(await l,await M(s,o)),setValue:async f=>(await l,await I(s,o,f)),setMeta:async f=>(await l,await p(s,o,f)),removeValue:async f=>(await l,await T(s,o,f)),removeMeta:async f=>(await l,await q(s,o,f)),watch:f=>F(s,o,(E,k)=>f(E??u(),k??u())),migrate:b}}}}function W(a){const e=()=>{if(D.runtime==null)throw Error(["'wxt/storage' must be loaded in a web extension environment",`
 - If thrown during a build, see https://github.com/wxt-dev/wxt/issues/371`,` - If thrown during tests, mock 'wxt/browser' correctly. See https://wxt.dev/guide/go-further/testing.html
`].join(`
`));if(D.storage==null)throw Error("You must add the 'storage' permission to your manifest to use 'wxt/storage'");const r=D.storage[a];if(r==null)throw Error(`"browser.storage.${a}" is undefined`);return r},t=new Set;return{getItem:async r=>(await e().get(r))[r],getItems:async r=>{const w=await e().get(r);return r.map(c=>({key:c,value:w[c]??null}))},setItem:async(r,w)=>{w==null?await e().remove(r):await e().set({[r]:w})},setItems:async r=>{const w=r.reduce((c,{key:x,value:v})=>(c[x]=v,c),{});await e().set(w)},removeItem:async r=>{await e().remove(r)},removeItems:async r=>{await e().remove(r)},clear:async()=>{await e().clear()},snapshot:async()=>await e().get(),restoreSnapshot:async r=>{await e().set(r)},watch(r,w){const c=x=>{const v=x[r];v!=null&&(Y(v.newValue,v.oldValue)||w(v.newValue??null,v.oldValue??null))};return e().onChanged.addListener(c),t.add(c),()=>{e().onChanged.removeListener(c),t.delete(c)}},unwatch(){t.forEach(r=>{e().onChanged.removeListener(r)}),t.clear()}}}class we extends Error{constructor(e,t,r){super(`v${t} migration failed for "${e}"`,r),this.key=e,this.version=t}}const xe={connected:!1,event:"",numThrows:0,status:""},re=K.defineItem("local:board-data",{defaultValue:xe}),ve={images:["","",""]},se=K.defineItem("local:board-images",{defaultValue:ve}),be={private:!1,gameMode:"X01",match:void 0},Z=K.defineItem("local:game-data",{defaultValue:be}),ye=K.defineItem("local:lobby-data",{defaultValue:void 0});async function pe(a,e){var t,r,w;switch(a){case"autodarts.lobbies":{if(e=e,((t=window.location.href.match(/lobbies\/([0-9a-f-]+)/))==null?void 0:t[1])!==e.id)return;ye.setValue(e);break}case"autodarts.matches":{if(e=e,e.body)return;const c=(r=window.location.href.match(/matches\/([0-9a-f-]+)/))==null?void 0:r[1],x=(w=e.players)==null?void 0:w.find(M=>{var I;return M.boardId===((I=window.location.href.match(/boards\/([0-9a-f-]+)/))==null?void 0:I[1])});if(c!==e.id&&!x&&e.activated===void 0)return;const v=await Z.getValue();e.activated!==void 0?Z.setValue({...v,match:v.match?{...v.match,activated:e.activated}:{...e}}):Z.setValue({...v,match:e});break}case"autodarts.boards":{e=e;const c=await re.getValue();re.setValue({...c,...e});break}case"autodarts.boards.images":{e=e;const c=await se.getValue();for(c.images.push(e);c.images.length>6;)c.images.shift();se.setValue(c);break}default:{console.log("Unknown channel",a);break}}}const Ee={matches:["*://play.autodarts.io/*"],async main(a){console.log("Injecting WebSocket capture script...");try{await ce("/websocket-capture.js",{keepInDom:!0}),console.log("WebSocket capture script injected successfully"),a.addEventListener(window,"websocket-incoming",e=>{const{data:t}=e.detail;if(typeof t=="string")try{const r=JSON.parse(t);console.log("[Content Script] Parsed JSON data:",r),pe(r.channel,r.data).catch(console.error)}catch{}}),a.addEventListener(window,"websocket-outgoing",e=>{const{data:t}=e.detail;if(typeof t=="string")try{const r=JSON.parse(t)}catch{}})}catch(e){console.error("Failed to inject WebSocket capture script:",e)}}};function U(a,...e){}const ke={debug:(...a)=>U(console.debug,...a),log:(...a)=>U(console.log,...a),warn:(...a)=>U(console.warn,...a),error:(...a)=>U(console.error,...a)},G=class G extends Event{constructor(e,t){super(G.EVENT_NAME,{}),this.newUrl=e,this.oldUrl=t}};N(G,"EVENT_NAME",H("wxt:locationchange"));let z=G;function H(a){var e;return`${(e=j==null?void 0:j.runtime)==null?void 0:e.id}:websocket-monitor:${a}`}function Ie(a){let e,t;return{run(){e==null&&(t=new URL(location.href),e=a.setInterval(()=>{let r=new URL(location.href);r.href!==t.href&&(window.dispatchEvent(new z(r,t)),t=r)},1e3))}}}const R=class R{constructor(e,t){N(this,"isTopFrame",window.self===window.top);N(this,"abortController");N(this,"locationWatcher",Ie(this));N(this,"receivedMessageIds",new Set);this.contentScriptName=e,this.options=t,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(e){return this.abortController.abort(e)}get isInvalid(){return j.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(e){return this.signal.addEventListener("abort",e),()=>this.signal.removeEventListener("abort",e)}block(){return new Promise(()=>{})}setInterval(e,t){const r=setInterval(()=>{this.isValid&&e()},t);return this.onInvalidated(()=>clearInterval(r)),r}setTimeout(e,t){const r=setTimeout(()=>{this.isValid&&e()},t);return this.onInvalidated(()=>clearTimeout(r)),r}requestAnimationFrame(e){const t=requestAnimationFrame((...r)=>{this.isValid&&e(...r)});return this.onInvalidated(()=>cancelAnimationFrame(t)),t}requestIdleCallback(e,t){const r=requestIdleCallback((...w)=>{this.signal.aborted||e(...w)},t);return this.onInvalidated(()=>cancelIdleCallback(r)),r}addEventListener(e,t,r,w){var c;t==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(c=e.addEventListener)==null||c.call(e,t.startsWith("wxt:")?H(t):t,r,{...w,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),ke.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:R.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(e){var c,x,v;const t=((c=e.data)==null?void 0:c.type)===R.SCRIPT_STARTED_MESSAGE_TYPE,r=((x=e.data)==null?void 0:x.contentScriptName)===this.contentScriptName,w=!this.receivedMessageIds.has((v=e.data)==null?void 0:v.messageId);return t&&r&&w}listenForNewerScripts(e){let t=!0;const r=w=>{if(this.verifyScriptStartedEvent(w)){this.receivedMessageIds.add(w.data.messageId);const c=t;if(t=!1,c&&(e!=null&&e.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",r),this.onInvalidated(()=>removeEventListener("message",r))}};N(R,"SCRIPT_STARTED_MESSAGE_TYPE",H("wxt:content-script-started"));let J=R;function Me(){}function B(a,...e){}const Se={debug:(...a)=>B(console.debug,...a),log:(...a)=>B(console.log,...a),warn:(...a)=>B(console.warn,...a),error:(...a)=>B(console.error,...a)};return(async()=>{try{const{main:a,...e}=Ee,t=new J("websocket-monitor",e);return await a(t)}catch(a){throw Se.error('The content script "websocket-monitor" crashed on startup!',a),a}})()}();
websocketMonitor;
